# CO-SAFE Connect â€“ Quick Reference

## Product Snapshot
- PWA for real-time vehicle CO monitoring in cars; works offline and is installable.
- Prioritizes fast mobile UX with tab navigation instead of routing and haptic feedback hooks.
- Alerts, analytics, and emergency actions revolve around configurable thresholds.

## Core Stack
- App: React 19, TypeScript, Vite 7.
- State: Zustand with `persist` middleware (storage key `co-safe-storage`).
- UI: Tailwind CSS, Radix UI primitives, class-variance-authority, Framer Motion, lucide icons.
- Data viz: Canvas-based chart components, Recharts for analytics, `react-gauge-component` for gauges.
- PWA: `vite-plugin-pwa` + Workbox (register mode `prompt`, assets cached for fonts/images).
- Tooling: ESLint 9, PostCSS/Tailwind pipeline, Netlify deploy via `netlify.toml`.

## Workflow
- Install dependencies: `npm install`
- Run dev server: `npm run dev`
- Build production bundle: `npm run build`
- Preview build output: `npm run preview`

## Source Layout
- `src/main.tsx` bootstraps React and mounts the app.
- `src/App.tsx` switches between four tabs (`home`, `alerts`, `analytics`, `settings`) without React Router.
- `src/components/` reusable pieces: `alerts/`, `charts/`, `layout/`, `ui/`, plus `Speedometer.tsx` and `PWAReloadPrompt.tsx`.
- `src/pages/` tab screens `Dashboard`, `Alerts`, `Analytics`, `Settings`.
- `src/store/useAppStore.ts` Zustand store holding device state, readings history, alerts, settings, UI flags.
- `src/types/index.ts` TypeScript interfaces and constants (thresholds, device config, chart limits).
- `src/utils/pwa.ts` service worker manager and `usePWA` hook.
- `src/screens/` legacy/alternate layouts retained for experiments.
- `public/` manifest, icons, Netlify `_redirects`; service worker output is generated at build time.

## Architecture Highlights
- **Navigation:** Local tab state in `App.tsx` for instant screen swaps and vibration feedback on supported devices.
- **State model:** Persisted readings (capped ~1000) and alerts (capped 100); store auto-raises alerts when values cross warning/critical thresholds and exposes computed helpers (status, latest reading, counts).
- **PWA flow:** `vite-plugin-pwa` registers on load; `PWAReloadPrompt` invites users to refresh when a new service worker is ready rather than forcing `skipWaiting`.
- **Data visualization:** `components/charts/COChart.tsx` uses Canvas for 24h history with pan/zoom; `COGauge` and `Speedometer` cover gauge-style displays.
- **Theming:** Tailwind + CSS variables toggled by `settings.darkMode`; applied via `useEffect` in `App.tsx`.

## Screen Summaries
- **Dashboard (`src/pages/Dashboard.tsx`):** Current reading gauge, device status cards, environmental info, emergency call action, and demo mode toggle.
- **Alerts (`src/pages/Alerts.tsx`):** Active vs acknowledged lists with acknowledge/clear actions using `AlertBanner` and `AlertCard`.
- **Analytics (`src/pages/Analytics.tsx`):** Range selector (1h/24h/7d), average/max/min stats, Recharts area + pie charts for status distribution.
- **Settings (`src/pages/Settings.tsx`):** Threshold sliders, emergency contact, notification/audio/dark-mode toggles, device metadata, clear-data dialog.

## Key Components & Utilities
- `components/layout/TopBar.tsx` and `TabBar.tsx` supply the app chrome and navigation controls.
- `components/ui/` exports Radix-based primitives (button, dialog, drawer, input, switch, tabs, toast, etc.) styled through CVA.
- `components/alerts/AlertBanner.tsx` and `AlertCard.tsx` standardize alert presentation across screens.
- `components/PWAReloadPrompt.tsx` surfaces service worker updates; `components/ui/OfflineIndicator.tsx` reflects connectivity.

## Types & Constants
- `COReading`, `HistoryDataPoint`, `COAlert`, `DeviceStatus`, `AppSettings`, `ChartViewport`, and `TabName` live in `src/types/index.ts`.
- Threshold/config constants (`CO_THRESHOLDS`, `DEVICE_CONFIG`, `TIME_RANGES`, `CHART_CONFIG`) are colocated there for reuse by store, charts, and settings UI.

## Additional Notes
- Zustand persistence omits transient UI state but keeps critical device/reading data for offline continuity.
- `startSimulation` / `stopSimulation` actions produce demo readings when hardware is absent.
- Offline + update prompts rely on `usePWA`; rebuild the service worker after changing PWA settings.
- Netlify SPA routing depends on `public/_redirects`; avoid manual edits to generated `sw.js`.
- Do not run `npm run dev`, other `npm run *`, or any `npm` command without an explicit go-ahead from the user.
- When preparing commits, omit any autogenerated footers such as `Co-authored-by` entries for Claude or other assistants.
